---
title: "Water Chemistry Script"
format: html
editor: visual
execute: 
  echo: true
  warning: false
  message: false
---

## 

```{r}
library(metajam)
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(patchwork)
```

### Reading in the raw data

```{r}
## Read in the data using metajam:

raw_BQ1 <- metajam::read_d1_files(
  folder_path = "/courses/EDS214/threeza-crowd/__QuebradaCuenca1-Bisley__csv", 
  fnc = "read_csv")
raw_BQ2 <- metajam::read_d1_files(
  folder_path = "/courses/EDS214/threeza-crowd/__QuebradaCuenca2-Bisley__csv", 
  fnc = "read_csv")
raw_BQ3 <- metajam::read_d1_files(
  folder_path = "/courses/EDS214/threeza-crowd/__QuebradaCuenca3-Bisley__csv", 
  fnc = "read_csv")
raw_PRM <- metajam::read_d1_files(
  folder_path = "/courses/EDS214/threeza-crowd/__RioMameyesPuenteRoto__csv", 
  fnc = "read_csv")

## Save the data frames from each site data set as the initial data frame for each

raw_BQ1 <- raw_BQ1$data
raw_BQ2 <- raw_BQ2$data
raw_BQ3 <- raw_BQ3$data
raw_PRM <- raw_PRM$data
```

## Pseudo Code

```{r}
##Read in Q1, Q2, Q3, RMP data sets
##Merge the 4 data sets by date
##Clean names
##Pivot longer
##Select for NO3- (Nitrate) and K (Potassium)
##Group by site
##ggplot for Potassium
##ggplot for Nitrate
##add ggplots together using divide (potassium/nitrate)
```

## Cleaning the data

```{r}
bq1 <- raw_BQ1 %>% 
  clean_names()

bq2 <- raw_BQ2 %>% 
  clean_names()

bq3 <- raw_BQ3 %>% 
  clean_names()

prm <- raw_PRM %>%
  clean_names()
```

## Combine the rows

```{r}
joined_data <- bind_rows(bq1, bq2, bq3, prm)

## select to keep rows: sample_id, sample_date, no3_n, k
stream_quality <- joined_data %>%
  select(sample_id, sample_date, no3_n, k) %>% 
  mutate(year = year(sample_date),
         date = ymd(paste0(year, "-", month(sample_date), "-1"))) %>% 
  filter(year %in% 1988:1994) 

monthly_quality <- stream_quality %>% 
  group_by(sample_id, date) %>%  
  summarize(monthlyno3 = mean(no3_n, na.rm = TRUE),
            monthlyk = mean(k, na.rm = TRUE))

## We might want to add a column for the chemical type (pivot.longer)
```

```{r}
## select to keep rows: sample_id, sample_date, no3_n, k

```

## Creating our first graph

```{r}
monthlyno3graph <- ggplot(monthly_quality, aes(x = date, y = monthlyno3)) +
  geom_line(aes(color = sample_id))

monthlykgraph <- ggplot(monthly_quality, aes(x = date, y = monthlyk)) +
  geom_line(aes(color = sample_id))


monthlyno3graph / monthlykgraph
```
